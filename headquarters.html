<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONEæ¡ŒéŠ AI å®¢æœ - ç¸½éƒ¨æˆ°æƒ…å®¤</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        /* ç™»å…¥é é¢ */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        .login-logo {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .login-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .login-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 30px;
        }
        
        .login-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
        }
        
        .login-error {
            background: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        /* ä¸»ä»‹é¢ */
        .main-app {
            display: none;
            background: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
        }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-right: 1px solid #334155;
            padding: 30px 20px;
            overflow-y: auto;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #334155;
        }
        
        .nav-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-item:hover { background: #1e293b; color: #fff; }
        .nav-item.active { background: #3b82f6; color: #fff; }
        
        .main-content {
            margin-left: 260px;
            padding: 30px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .header h1 { font-size: 28px; color: #fff; }
        
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn:hover { background: #2563eb; transform: translateY(-1px); }
        .btn.secondary { background: #64748b; }
        .btn.success { background: #10b981; }
        .btn.danger { background: #ef4444; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #334155;
        }
        
        .stat-label { font-size: 14px; color: #94a3b8; margin-bottom: 10px; }
        .stat-value { font-size: 36px; font-weight: 700; color: #fff; margin-bottom: 10px; }
        .stat-change { font-size: 14px; color: #10b981; }
        
        .panel {
            background: #1e293b;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #334155;
        }
        
        .panel h2 {
            font-size: 20px;
            color: #fff;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .merchant-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .merchant-card {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .merchant-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        
        .merchant-header {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 15px;
        }
        
        .merchant-info {
            font-size: 13px;
            color: #94a3b8;
            margin-bottom: 15px;
        }
        
        .merchant-stores {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        
        .store-tag {
            background: #334155;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            color: #cbd5e1;
        }
        
        .conversation-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .conversation-item {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
        }
        
        .conversation-time {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 8px;
        }
        
        .conversation-store {
            font-size: 13px;
            color: #3b82f6;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .conversation-content {
            font-size: 14px;
            color: #cbd5e1;
            line-height: 1.6;
        }
        
        .conversation-user {
            color: #94a3b8;
            margin-bottom: 5px;
        }
        
        .conversation-ai {
            color: #10b981;
            margin-top: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #334155;
        }
        
        th {
            background: #0f172a;
            font-weight: 600;
            color: #94a3b8;
            font-size: 13px;
        }
        
        td {
            font-size: 14px;
            color: #cbd5e1;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .badge.success { background: #10b98133; color: #10b981; }
        .badge.warning { background: #f59e0b33; color: #f59e0b; }
        .badge.error { background: #ef444433; color: #ef4444; }
        
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: #0f172a;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .auto-refresh input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body>
    <!-- ç™»å…¥é é¢ -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="login-logo">ğŸ®</div>
            <div class="login-title">ONEæ¡ŒéŠç¸½éƒ¨æˆ°æƒ…å®¤</div>
            <div class="login-subtitle">åƒ…é™æˆæ¬Šäººå“¡é€²å…¥</div>
            
            <form id="loginForm" onsubmit="login(event)">
                <input type="password" class="login-input" id="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" autofocus>
                <button type="submit" class="login-btn">é€²å…¥æˆ°æƒ…å®¤</button>
                <div class="login-error" id="loginError">âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡è©¦</div>
            </form>
            
            <div style="margin-top: 20px; font-size: 12px; color: #999;">
                Â© 2026 ONEæ¡ŒéŠ | v3.0
            </div>
        </div>
    </div>
    
    <!-- ä¸»ä»‹é¢ -->
    <div class="main-app" id="mainApp">
        <div class="sidebar">
            <div class="logo">ğŸ® ONEæ¡ŒéŠç¸½éƒ¨</div>
            
            <div class="nav-item active" onclick="showSection('dashboard')">ğŸ“Š ç¸½è¦½å„€è¡¨æ¿</div>
            <div class="nav-item" onclick="showSection('merchants')">ğŸ‘¥ å•†å®¶ç®¡ç†</div>
            <div class="nav-item" onclick="showSection('monitor')">ğŸ’¬ å³æ™‚å°è©±</div>
            <div class="nav-item" onclick="showSection('analytics')">ğŸ“ˆ æ•¸æ“šåˆ†æ</div>
            <div class="nav-item" onclick="showSection('alerts')">ğŸ”” è­¦å ±è¨˜éŒ„</div>
            <div class="nav-item" onclick="showSection('config')">âš™ï¸ ç³»çµ±è¨­å®š</div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #334155;">
                <div style="font-size: 12px; color: #64748b; margin-bottom: 10px;">ç³»çµ±ç‹€æ…‹</div>
                <div style="font-size: 13px; color: #10b981;">â— é‹è¡Œä¸­</div>
                <div style="font-size: 12px; color: #64748b; margin-top: 8px;" id="currentTime"></div>
                <button class="btn danger" onclick="logout()" style="width: 100%; margin-top: 15px; padding: 8px;">ğŸšª ç™»å‡º</button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Section: ç¸½è¦½å„€è¡¨æ¿ -->
            <div id="section-dashboard">
                <div class="header">
                    <h1>ğŸ“Š ç¸½è¦½å„€è¡¨æ¿</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn secondary">ğŸ“¥ åŒ¯å‡ºå ±è¡¨</button>
                        <button class="btn" onclick="refreshData()">ğŸ”„ åˆ·æ–°æ•¸æ“š</button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ç¸½å•†å®¶æ•¸</div>
                        <div class="stat-value" id="totalMerchants">12</div>
                        <div class="stat-change">ç®¡ç† 90 å®¶åº—</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæ—¥å°è©±é‡</div>
                        <div class="stat-value">8,247</div>
                        <div class="stat-change">+12.3% vs æ˜¨æ—¥</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">AI è™•ç†ç‡</div>
                        <div class="stat-value">94.2<span style="font-size: 20px;">%</span></div>
                        <div class="stat-change">+2.1% æœ¬é€±</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">æ´»èºå•†å®¶</div>
                        <div class="stat-value" style="color: #10b981;">12</div>
                        <div class="stat-change">100% æ­£å¸¸é‹è¡Œ</div>
                    </div>
                </div>
            </div>
            
            <!-- Section: å•†å®¶ç®¡ç† -->
            <div id="section-merchants" style="display: none;">
                <div class="header">
                    <h1>ğŸ‘¥ å•†å®¶ç®¡ç†</h1>
                    <button class="btn success" onclick="addMerchant()">+ æ–°å¢å•†å®¶</button>
                </div>
                
                <div class="panel">
                    <h2>å•†å®¶åˆ—è¡¨</h2>
                    <div class="merchant-grid" id="merchantGrid"></div>
                </div>
                
                <div class="panel">
                    <h2>ğŸ“Š å•†å®¶è©³ç´°è³‡æ–™</h2>
                    <table>
                        <tr>
                            <th>å•†å®¶ ID</th>
                            <th>å•†å®¶åç¨±</th>
                            <th>è² è²¬äºº</th>
                            <th>é›»è©±</th>
                            <th>åº—å®¶æ•¸é‡</th>
                            <th>ç‹€æ…‹</th>
                            <th>æ“ä½œ</th>
                        </tr>
                        <tbody id="merchantTable"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Section: å³æ™‚å°è©±ç›£æ§ -->
            <div id="section-monitor" style="display: none;">
                <div class="header">
                    <h1>ğŸ’¬ å³æ™‚å°è©±ç›£æ§</h1>
                    <button class="btn" onclick="refreshConversations()">ğŸ”„ æ‰‹å‹•åˆ·æ–°</button>
                </div>
                
                <div class="auto-refresh">
                    <input type="checkbox" id="autoRefresh" checked onchange="toggleAutoRefresh()">
                    <label for="autoRefresh" style="color: #cbd5e1; font-size: 14px;">è‡ªå‹•åˆ·æ–°ï¼ˆæ¯ 10 ç§’ï¼‰</label>
                    <span id="refreshStatus" style="color: #10b981; font-size: 12px; margin-left: auto;">â— é‹è¡Œä¸­</span>
                </div>
                
                <div class="panel">
                    <h2>æœ€è¿‘ 50 å‰‡å°è©±</h2>
                    <div class="conversation-list" id="conversationList">
                        <!-- å°è©±è¨˜éŒ„å‹•æ…‹è¼‰å…¥ -->
                    </div>
                </div>
            </div>
            
            <!-- Section: æ•¸æ“šåˆ†æ -->
            <div id="section-analytics" style="display: none;">
                <div class="header">
                    <h1>ğŸ“ˆ æ•¸æ“šåˆ†æ</h1>
                    <button class="btn secondary">ğŸ“¥ åŒ¯å‡ºåˆ†æå ±è¡¨</button>
                </div>
                
                <div class="panel">
                    <h2>å•†å®¶å°è©±é‡æ’è¡Œ</h2>
                    <table>
                        <tr>
                            <th>#</th>
                            <th>å•†å®¶åç¨±</th>
                            <th>ä»Šæ—¥å°è©±</th>
                            <th>AI è™•ç†ç‡</th>
                            <th>è½‰çœŸäººç‡</th>
                        </tr>
                        <tbody id="analyticsTable"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Section: è­¦å ±è¨˜éŒ„ -->
            <div id="section-alerts" style="display: none;">
                <div class="header">
                    <h1>ğŸ”” è­¦å ±è¨˜éŒ„</h1>
                </div>
                
                <div class="panel">
                    <h2>ç³»çµ±è­¦å ±ï¼ˆæœ€è¿‘ 7 å¤©ï¼‰</h2>
                    <p style="color: #cbd5e1;">è­¦å ±è¨˜éŒ„åŠŸèƒ½...</p>
                </div>
            </div>
            
            <!-- Section: ç³»çµ±è¨­å®š -->
            <div id="section-config" style="display: none;">
                <div class="header">
                    <h1>âš™ï¸ ç³»çµ±è¨­å®š</h1>
                    <button class="btn success" onclick="testConnection()">ğŸ”Œ æ¸¬è©¦é€£ç·š</button>
                </div>
                
                <div class="panel">
                    <h2>Google Sheets é€£æ¥è¨­å®š</h2>
                    <p style="color: #94a3b8; margin-bottom: 20px;">è¨­å®šä¸€æ¬¡å³è‡ªå‹•å„²å­˜</p>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: #cbd5e1; font-weight: 600;">ğŸ“Š Google Sheets ID</label>
                        <input type="text" id="sheetId" placeholder="å¾ Sheets ç¶²å€è¤‡è£½ ID" style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #0f172a; color: #e2e8f0;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: #cbd5e1; font-weight: 600;">ğŸ”‘ Apps Script Web App URL</label>
                        <input type="text" id="webAppUrl" placeholder="https://script.google.com/macros/s/.../exec" style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #0f172a; color: #e2e8f0;">
                    </div>
                    
                    <button class="btn" onclick="saveConfig()">ğŸ’¾ å„²å­˜é…ç½®</button>
                    <button class="btn secondary" onclick="clearConfig()">ğŸ—‘ï¸ æ¸…é™¤é…ç½®</button>
                </div>
                
                <div class="panel">
                    <h2>ç›®å‰é…ç½®ç‹€æ…‹</h2>
                    <div id="configStatus" style="color: #94a3b8;">å°šæœªé…ç½®</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const PASSWORD = 'zxc88888';
        let autoRefreshInterval = null;
        
        // å•†å®¶è³‡æ–™
        const merchants = [
            { id: 'M001', name: 'Ken çš„å•†å®¶', owner: 'Ken', phone: '0900-000-000', stores: ['åœŸåŸåº—', 'æ–°èŠåº—', 'æ¿æ©‹åº—', 'ä¸­å’Œåº—', 'æ°¸å’Œåº—', 'ä¸‰é‡åº—', 'è˜†æ´²åº—', 'æ·¡æ°´åº—'], status: 'active', todayConv: 2450, aiRate: 95.2, transferRate: 4.8 },
            { id: 'M002', name: 'å•†å®¶ B', owner: 'å¼µè€é—†', phone: '0911-111-111', stores: ['æ¡ƒåœ’åº—', 'ä¸­å£¢åº—', 'å¹³é®åº—'], status: 'active', todayConv: 980, aiRate: 93.1, transferRate: 6.9 },
            { id: 'M003', name: 'å•†å®¶ C', owner: 'æç¶“ç†', phone: '0922-222-222', stores: ['å°ä¸­åº—', 'è±åŸåº—', 'å¤§é‡Œåº—', 'å¤ªå¹³åº—'], status: 'active', todayConv: 1520, aiRate: 94.8, transferRate: 5.2 }
        ];
        
        // ç™»å…¥
        function login(event) {
            event.preventDefault();
            const password = document.getElementById('password').value;
            const error = document.getElementById('loginError');
            
            if (password === PASSWORD) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                initApp();
            } else {
                error.style.display = 'block';
                document.getElementById('password').value = '';
                setTimeout(() => { error.style.display = 'none'; }, 3000);
            }
        }
        
        // ç™»å‡º
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('password').value = '';
                if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            }
        }
        
        // åˆå§‹åŒ–
        function initApp() {
            renderMerchants();
            renderAnalytics();
            loadConfig();
            updateTime();
            setInterval(updateTime, 1000);
            startAutoRefresh();
        }
        
        // æ¸²æŸ“å•†å®¶
        function renderMerchants() {
            const grid = document.getElementById('merchantGrid');
            grid.innerHTML = merchants.map(m => `
                <div class="merchant-card">
                    <div class="merchant-header">${m.name}</div>
                    <div class="merchant-info">
                        è² è²¬äººï¼š${m.owner}<br>
                        é›»è©±ï¼š${m.phone}<br>
                        ç®¡ç†åº—å®¶ï¼š${m.stores.length} å®¶
                    </div>
                    <div class="merchant-stores">
                        ${m.stores.map(s => `<div class="store-tag">${s}</div>`).join('')}
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn" style="flex: 1; padding: 8px;" onclick="editMerchant('${m.id}')">ç·¨è¼¯</button>
                        <button class="btn secondary" style="flex: 1; padding: 8px;" onclick="viewStores('${m.id}')">æŸ¥çœ‹åº—å®¶</button>
                    </div>
                </div>
            `).join('');
            
            const table = document.getElementById('merchantTable');
            table.innerHTML = merchants.map(m => `
                <tr>
                    <td>${m.id}</td>
                    <td>${m.name}</td>
                    <td>${m.owner}</td>
                    <td>${m.phone}</td>
                    <td>${m.stores.length}</td>
                    <td><span class="badge success">é‹è¡Œä¸­</span></td>
                    <td>
                        <button class="btn" style="padding: 6px 12px; font-size: 12px;" onclick="editMerchant('${m.id}')">ç·¨è¼¯</button>
                    </td>
                </tr>
            `).join('');
        }
        
        // æ¸²æŸ“åˆ†æ
        function renderAnalytics() {
            const table = document.getElementById('analyticsTable');
            const sorted = [...merchants].sort((a, b) => b.todayConv - a.todayConv);
            table.innerHTML = sorted.map((m, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${m.name}</td>
                    <td>${m.todayConv}</td>
                    <td>${m.aiRate}%</td>
                    <td>${m.transferRate}%</td>
                </tr>
            `).join('');
        }
        
        // æ¸²æŸ“å°è©±ï¼ˆæ¨¡æ“¬ï¼‰
        function renderConversations() {
            const list = document.getElementById('conversationList');
            const now = new Date();
            const conversations = [];
            
            for (let i = 0; i < 10; i++) {
                const time = new Date(now - i * 120000);
                const stores = ['åœŸåŸåº—', 'æ–°èŠåº—', 'æ¿æ©‹åº—', 'ä¸­å’Œåº—'];
                const store = stores[Math.floor(Math.random() * stores.length)];
                const questions = ['è«‹å•ç‡Ÿæ¥­æ™‚é–“ï¼Ÿ', 'WiFi å¯†ç¢¼æ˜¯ä»€éº¼ï¼Ÿ', 'æœ‰ç©ºä½å—ï¼Ÿ', 'åŒ…å»‚å¤šå°‘éŒ¢ï¼Ÿ', 'è½‰çœŸäºº'];
                const question = questions[Math.floor(Math.random() * questions.length)];
                
                conversations.push({
                    time: time.toLocaleTimeString('zh-TW'),
                    store: `ONEæ¡ŒéŠ ${store}`,
                    user: question,
                    ai: question === 'è½‰çœŸäºº' ? 'âœ… å·²ç‚ºæ‚¨è½‰æ¥çœŸäººå®¢æœ...' : 'AI è‡ªå‹•å›è¦†ä¸­...'
                });
            }
            
            list.innerHTML = conversations.map(c => `
                <div class="conversation-item">
                    <div class="conversation-time">${c.time}</div>
                    <div class="conversation-store">${c.store}</div>
                    <div class="conversation-content">
                        <div class="conversation-user">å®¢äººï¼š${c.user}</div>
                        <div class="conversation-ai">AIï¼š${c.ai}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // è‡ªå‹•åˆ·æ–°
        function startAutoRefresh() {
            renderConversations();
            autoRefreshInterval = setInterval(() => {
                if (document.getElementById('autoRefresh').checked) {
                    renderConversations();
                }
            }, 10000);
        }
        
        function toggleAutoRefresh() {
            const status = document.getElementById('refreshStatus');
            if (document.getElementById('autoRefresh').checked) {
                status.textContent = 'â— é‹è¡Œä¸­';
                status.style.color = '#10b981';
            } else {
                status.textContent = 'â—‹ å·²æš«åœ';
                status.style.color = '#64748b';
            }
        }
        
        function refreshConversations() {
            renderConversations();
            alert('âœ… å·²åˆ·æ–°å°è©±è¨˜éŒ„');
        }
        
        // é…ç½®ç®¡ç†
        function saveConfig() {
            const sheetId = document.getElementById('sheetId').value;
            const webAppUrl = document.getElementById('webAppUrl').value;
            
            if (!sheetId || !webAppUrl) {
                alert('âŒ è«‹å¡«å…¥å®Œæ•´è³‡è¨Š');
                return;
            }
            
            localStorage.setItem('hq_sheetId', sheetId);
            localStorage.setItem('hq_webAppUrl', webAppUrl);
            alert('âœ… é…ç½®å·²å„²å­˜ï¼');
            loadConfig();
        }
        
        function loadConfig() {
            const sheetId = localStorage.getItem('hq_sheetId');
            const webAppUrl = localStorage.getItem('hq_webAppUrl');
            
            if (sheetId) document.getElementById('sheetId').value = sheetId;
            if (webAppUrl) document.getElementById('webAppUrl').value = webAppUrl;
            
            const status = document.getElementById('configStatus');
            if (sheetId && webAppUrl) {
                status.innerHTML = `
                    <div style="color: #10b981; font-weight: 600; margin-bottom: 10px;">âœ… å·²é…ç½®</div>
                    <div style="font-size: 13px; color: #94a3b8;">
                        Sheets ID: ${sheetId.substring(0, 20)}...<br>
                        Web App: ${webAppUrl.substring(0, 50)}...
                    </div>
                `;
            } else {
                status.innerHTML = '<div style="color: #f59e0b;">âš ï¸ å°šæœªé…ç½®</div>';
            }
        }
        
        function clearConfig() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤é…ç½®å—ï¼Ÿ')) {
                localStorage.removeItem('hq_sheetId');
                localStorage.removeItem('hq_webAppUrl');
                document.getElementById('sheetId').value = '';
                document.getElementById('webAppUrl').value = '';
                loadConfig();
                alert('âœ… é…ç½®å·²æ¸…é™¤');
            }
        }
        
        function testConnection() {
            const sheetId = localStorage.getItem('hq_sheetId');
            if (!sheetId) {
                alert('âŒ è«‹å…ˆé…ç½®ç³»çµ±è¨­å®š');
                return;
            }
            alert('ğŸ”Œ æ¸¬è©¦é€£ç·š...\n\nå¯¦éš›ä½¿ç”¨æ™‚æœƒæ¸¬è©¦èˆ‡ Google Sheets çš„é€£ç·šã€‚');
        }
        
        // å…¶ä»–æ“ä½œ
        function showSection(section) {
            ['dashboard', 'merchants', 'monitor', 'analytics', 'alerts', 'config'].forEach(s => {
                const el = document.getElementById('section-' + s);
                if (el) el.style.display = 'none';
            });
            const target = document.getElementById('section-' + section);
            if (target) target.style.display = 'block';
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (section === 'monitor') renderConversations();
        }
        
        function addMerchant() {
            alert('é–‹å•Ÿæ–°å¢å•†å®¶è¡¨å–®...\n\nå¯¦éš›ä½¿ç”¨æ™‚æœƒå½ˆå‡ºè¡¨å–®å¡«å¯«å•†å®¶è³‡è¨Šã€‚');
        }
        
        function editMerchant(id) {
            alert(`ç·¨è¼¯å•†å®¶ ${id}...\n\nå¯¦éš›ä½¿ç”¨æ™‚æœƒé–‹å•Ÿç·¨è¼¯è¡¨å–®ã€‚`);
        }
        
        function viewStores(id) {
            const merchant = merchants.find(m => m.id === id);
            if (merchant) {
                alert(`${merchant.name} çš„æ‰€æœ‰åº—å®¶ï¼š\n\n${merchant.stores.join('\n')}`);
            }
        }
        
        function refreshData() {
            alert('ğŸ”„ åˆ·æ–°æ•¸æ“š...\n\nå¯¦éš›ä½¿ç”¨æ™‚æœƒå¾ Google Sheets è¼‰å…¥æœ€æ–°æ•¸æ“šã€‚');
        }
        
        function updateTime() {
            const now = new Date();
            const el = document.getElementById('currentTime');
            if (el) el.textContent = now.toLocaleTimeString('zh-TW');
        }
    </script>
</body>
</html>
